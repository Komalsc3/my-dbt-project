{{ config(materialized="incremental", unique_key=["Id"]) }}
with
    loan_cte as (
        select
            loan_cms.id,
            loan_cms.currentassetstatus,
            loan_cms.loanstatus,
            loan_cms.liquidationtype,
            loan_cms.liquidationdate,
            loan_cms.liquidationpricegross,
            loan_cms.liquidationpricenet,
            loan_cms.currentassettype,
            loan_cms.upbamount,
            loan_cms.currentunpaidbalance,
            loan_cms.currentdeferredbalance,
            loan_cms.nextpaymentdue,
            loan_cms.interestrate,
            loan_cms.paymentamount,
            loan_cms.currentpaymentpiti,
            loan_cms.lastpaymentdate,
            loan_cms.currentescrowbalance,
            loan_cms.currentescrowadvancebalance,
            loan_cms.currentcorporateadvancebalance,
            loan_cms.currentlatefeebalance,
            loan_cms.paymenthistory,
            loan_cms.amortizationtype,
            loan_cms.mipercentage,
            loan_cms.maturitydate,
            loan_cms.loantype,
            loan_cms.investmentstrategy,
            loan_cms.lossmitstatus,
            loan_cms.lossmitstatusdate,
            loan_cms.lossmitflag,
            loan_cms.nexttaxpaymentdate,
            loan_cms.nexttaxpaymentamount,
            loan_cms.nextinsurancepaymentdate,
            loan_cms.nextinsurancepaymentamount,
            loan_cms.breachletterexpiredate,
            loan_cms.breachlettersentdate,
            loan_cms.breachletternextduedate,
            loan_cms.transferasofdate,
            loan_cms.transferdate,
            loan_cms.micompanyid,
            loan_cms.updatedat,
            loan_cms.updatedby
        from {{ ref("stage_update_svc_cms_loan") }} loan_cms
        union all
        select
            loan_lh.id,
            loan_lh.currentassetstatus,
            loan_lh.loanstatus,
            loan_lh.liquidationtype,
            loan_lh.liquidationdate,
            loan_lh.liquidationpricegross,
            loan_lh.liquidationpricenet,
            loan_lh.currentassettype,
            loan_lh.upbamount,
            loan_lh.currentunpaidbalance,
            loan_lh.currentdeferredbalance,
            loan_lh.nextpaymentdue,
            loan_lh.interestrate,
            loan_lh.paymentamount,
            loan_lh.currentpaymentpiti,
            loan_lh.lastpaymentdate,
            loan_lh.currentescrowbalance,
            loan_lh.currentescrowadvancebalance,
            loan_lh.currentcorporateadvancebalance,
            loan_lh.currentlatefeebalance,
            loan_lh.paymenthistory,
            loan_lh.amortizationtype,
            loan_lh.mipercentage,
            loan_lh.maturitydate,
            loan_lh.loantype,
            loan_lh.investmentstrategy,
            loan_lh.lossmitstatus,
            loan_lh.lossmitstatusdate,
            loan_lh.lossmitflag,
            loan_lh.nexttaxpaymentdate,
            loan_lh.nexttaxpaymentamount,
            loan_lh.nextinsurancepaymentdate,
            loan_lh.nextinsurancepaymentamount,
            loan_lh.breachletterexpiredate,
            loan_lh.breachlettersentdate,
            loan_lh.breachletternextduedate,
            loan_lh.transferasofdate,
            loan_lh.transferdate,
            loan_lh.micompanyid,
            loan_lh.updatedat,
            loan_lh.updatedby
        from {{ ref("stage_update_svc_lh_loan") }} loan_lh
    )
select
    loan_cte.id,
    loan_cte.currentassetstatus,
    loan_cte.loanstatus,
    loan_cte.liquidationtype,
    loan_cte.liquidationdate,
    loan_cte.liquidationpricegross,
    loan_cte.liquidationpricenet,
    loan_cte.currentassettype,
    loan_cte.upbamount,
    loan_cte.currentunpaidbalance,
    loan_cte.currentdeferredbalance,
    loan_cte.nextpaymentdue,
    loan_cte.interestrate,
    loan_cte.paymentamount,
    loan_cte.currentpaymentpiti,
    loan_cte.lastpaymentdate,
    loan_cte.currentescrowbalance,
    loan_cte.currentescrowadvancebalance,
    loan_cte.currentcorporateadvancebalance,
    loan_cte.currentlatefeebalance,
    loan_cte.paymenthistory,
    loan_cte.amortizationtype,
    loan_cte.mipercentage,
    loan_cte.maturitydate,
    loan_cte.loantype,
    loan_cte.investmentstrategy,
    loan_cte.lossmitstatus,
    loan_cte.lossmitstatusdate,
    loan_cte.lossmitflag,
    loan_cte.nexttaxpaymentdate,
    loan_cte.nexttaxpaymentamount,
    loan_cte.nextinsurancepaymentdate,
    loan_cte.nextinsurancepaymentamount,
    loan_cte.breachletterexpiredate,
    loan_cte.breachlettersentdate,
    loan_cte.breachletternextduedate,
    loan_cte.transferasofdate,
    loan_cte.transferdate,
    loan_cte.micompanyid,
    loan_cte.updatedat,
    loan_cte.updatedby
from loan_cte
